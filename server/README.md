# Chip Player JS - API Server

This directory contains the Node.js API server for Chip Player JS. The server is responsible for providing metadata, search functionality, and file browsing for the music catalog.

## Setup

1.  **Install Dependencies:**
    ```bash
    npm install
    ```

2.  **Environment Variables:**
    Create a `.env` file in this directory by copying the example:
    ```bash
    cp .env.example .env
    ```
    Then, edit `.env` with your specific paths and URLs:
    -   `LOCAL_CATALOG_ROOT`: The absolute path to your music archive on the server's filesystem.
    -   `PUBLIC_CATALOG_URL`: The public-facing URL where the music archive is served.

3.  **Catalog:**
    The server requires `catalog.json` and `directories.json` to be present in this directory. These are generated by the `build-catalog` script in the parent `scripts` directory.

## Running the Server

You can run the server directly:
```bash
node index.js
```

For production, it's recommended to use a process manager like `pm2`.

### Production with pm2

1.  **`pm2` Ecosystem Config:**
    An example `pm2` configuration is provided in `ecosystem.config.example.js`. Copy it to create your own:
    ```bash
    cp ecosystem.config.example.js ecosystem.config.js
    ```
    Edit `ecosystem.config.js` and adjust the environment variables as needed for your production setup.

2.  **Start the server with `pm2`:**
    ```bash
    pm2 start ecosystem.config.js --env production
    ```

## Deployment

A deployment script example is provided in `deploy.example.sh`. This script uses `rsync` to copy the server files and `ssh` to run commands on the remote server.

1.  **Create your deployment script:**
    ```bash
    cp deploy.example.sh deploy.sh
    ```

2.  **Customize `deploy.sh`:**
    Edit the script and set your `REMOTE_HOST`, `REMOTE_USER`, and `REMOTE_DEST_DIR`.

3.  **Make it executable:**
    ```bash
    chmod +x deploy.sh
    ```

4.  **Run the deploy script:**
    ```bash
    ./deploy.sh
    ```
